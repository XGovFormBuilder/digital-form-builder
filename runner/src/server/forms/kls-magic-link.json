{
  "startPage": "/start",
  "skipSummary": true,
  "authentication": true,
  "toggle": true,
  "toggleRedirect": "/kls-path-1/which-organisation-do-you-work-for-DUPE",

  "retryTimeoutSeconds": 300,
    "analytics": {
    "matomoId": "11",
    "matomoUrl": "https://ukhsakls.matomo.cloud"
  },
  "magicLinkConfig": "kls-magic-link",
  "allowedDomains": ["ukhsa.gov.uk", "dhsc.gov.uk", "nhs.net", "nhs.uk", "gov.uk", "nccpentest.com", "nccgroup.com"],
  "invalidDomainRedirect": "/kls-magic-link/your-email-is-not-on-our-approved-list",
  "serviceName": "Knowledge and Library Services",
  "fullStartPage": "/kls-path-1/start",
  "pages": [
    {
      "path": "/start",
      "controller": "MagicLinkStartPageController",
      "unauthenticated": true
    },
    {
      "title": "What is your email address?",
      "path": "/email",
      "unauthenticated": true,
      "continueButtonText": "Continue",
      "showContinueButton": true,
      "backLinkFallback": "/kls-path-1/which-organisation-do-you-work-for",
      "components": [
        {
          "name": "EmailIntro",
          "options": {},
          "type": "Para",
          "content": "We need to email you a secure link to the service.<br><br>The link expires after 20 minutes.<br>",
          "schema": {}
        },
        {
          "type": "EmailAddressField",
          "title": "Email address",
          "name": "email",
          "options": {
            "exposeToContext": true,
            "customValidationMessages": {
              "string.empty": "Enter an email address",
              "string.pattern.base": "Enter an email address in the correct format, like name@example.com"
            }
          }
        },
        {
          "name": "alert",
          "type": "ContentWithState",
          "options": {
            "exposeToContext": true,
            "stateVariable": "minutesRemaining"
          },
          "content": "{% if minutesRemaining %}<div class='alert'><div class='govuk-warning-text'><span class='govuk-warning-text__icon' aria-hidden='true'>!</span><strong class='govuk-warning-text__text'><span class='govuk-visually-hidden'>Warning</span>You must wait {% if minutesRemaining == 1 %}1 minute{% else %}{{ minutesRemaining }} minutes{% endif %} before resubmitting the email</strong></div></div>{% endif %}"
        },
        {
          "name": "PrivacyNotice",
          "options": {},
          "type": "Para",
          "content": "By continuing, you agree to our <a href='https://www.gov.uk/government/publications/ukhsa-privacy-notice' target='_blank'>privacy notice</a>.",
          "schema": {}
        }
      ],
      "next": [
        {
          "path": "/submit1"
        }
      ]
    },
    {
      "path": "/submit1",
      "controller": "MagicLinkFirstSubmitPageController"
    },
    {
      "path": "/submit2",
      "controller": "MagicLinkSecondSubmitPageController"
    },
    {
      "path": "/check-your-email",
      "title": "Check your email",
      "unauthenticated": true,
      "backLinkFallback": "/start",
      "components": [
        {
          "name": "SentAnotherEmail",
          "options": {},
          "type": "Para",
          "content": "We’ve sent an email to {{ email }}. <p class=\"govuk-body\">Click the link in the email to continue to access the Knowledge and Library Services form.</p> <br><br> <h2 class=\"govuk-heading-m\">If you've not received an email</h2><p class=\"govuk-body\">Check your spam or junk folder.<br><br>If you’ve not received the email, you can resubmit the email in 5 minutes.</p>",
          "schema": {}
        },
        {
          "name": "alert",
          "type": "ContentWithState",
          "options": {
            "exposeToContext": true,
            "stateVariable": "minutesRemaining"
          },
          "content": "{% if minutesRemaining %}<div class='alert'><div class='govuk-warning-text'><span class='govuk-warning-text__icon' aria-hidden='true'>!</span><strong class='govuk-warning-text__text'><span class='govuk-visually-hidden'>Warning</span>You must wait {% if minutesRemaining == 1 %}1 minute{% else %}{{ minutesRemaining }} minutes{% endif %} before resubmitting the email</strong></div></div>{% endif %}"
        },
        {
          "name": "SentAnotherEmailButton",
          "options": {},
          "type": "Para",
          "content": "<a href='/kls-magic-link/submit2' role='button' draggable='false' class='govuk-button' data-module='govuk-button' data-prevent-double-click='true'>Send a new email</button></a>",
          "schema": {}
        }
      ]
    },
    {
      "backLinkFallback": "/kls-magic-link",
      "path": "/your-email-is-not-on-our-approved-list",
      "title": "Your email is not on our approved list",
      "unauthenticated": true,
      "components": [
        {
          "name": "GVrjNV",
          "options": {},
          "type": "Para",
          "content": " The email you provided does not match our approved email criteria. We only accept emails from goverment orgainsation limited to UKHSA, OHID, Local Authorities and the NHS (nhs.uk and nhs.net).<br>You can still contact the Knowledge and Library Services team via their <b>email</b>:<br> libraries@kls.ukhsa.gov.uk ",
          "schema": {}
        }
              ]

            },

    {

      "path": "/resubmit-email",
      "title": "We've sent you another email",
      "unauthenticated": true,
      "backLinkFallback": "/check-your-email",
      "components": [
        {
          "name": "SentAnotherEmail",
          "options": {},
          "type": "Para",
          "content": "We’ve sent another email to {{ email }}. <br><br> Click the link in the email to continue with your enquiry. <br><br>",
          "schema": {}
        },
        {
          "name": "NotReceivedEmail",
          "options": {},
          "type": "Para",
          "title": "If you've not received an email",
          "content": "<h3 class=\"govuk-heading-m\">If you've not received an email</h3><p class=\"govuk-body\">Check your spam or junk folder.<br><br>If you’ve still not received the email in 5 minutes, you need to request a new link.</p><a href='/kls-magic-link' role='button' draggable='false' class='govuk-button' data-module='govuk-button' data-prevent-double-click='true'>Request a new link</button></a>",
          "schema": {}
        }
      ],
      "next": []
    },
    {
      "title": "summary",
      "path": "/summary",
      "controller": "./pages/summary.js",
      "components": []
    },
    {
      "path": "/email-confirmed",
      "title": "Thank you for verifying your email",
      "disableBackLink": true,
      "components": [
        {
          "name": "EmailConfirmed",
          "options": {},
          "type": "Para",
          "content": "You will now be asked a series of questions. Please provide as much information as possible as this will help the UKHSA Knowledge and Library Services team deal with your enquiry promptly and accurately.<br><br><a href='/kls-path-1/which-organisation-do-you-work-for-DUPE' role='button' draggable='false' class='govuk-button' data-module='govuk-button' data-prevent-double-click='true'>Continue</button></a>",
          "schema": {}
        }
      ]
    },
    {
      "title": "return",
      "path": "/return",
      "controller": "MagicLinkController",
      "components": []
    },
    {
      "path": "/incorrect-email",
      "title": "Incorrect email link",
      "components": [
        {
          "name": "IncorrectEmail",
          "options": {},
          "type": "Para",
          "content": "The email you used does not match the email associated with this link.<br><br><a href='/kls-magic-link' role='button' draggable='false' class='govuk-button' data-module='govuk-button' data-prevent-double-click='true'>Request a new link</button></a>",
          "schema": {}
        }
      ]
    },
    {
      "path": "/expired",
      "title": "This link has expired",
      "components": [
        {
          "type": "Para",
          "title": "This link has expired",
          "content": "<a href='/kls-magic-link' role='button' draggable='false' class='govuk-button' data-module='govuk-button' data-prevent-double-click='true'>Request a new link</button></a>",
          "name": "blarGGH",
          "options": {},
          "schema": {}
        }
      ]
    }
  ],
  "specialPages": {
    "confirmationPage": {
      "customText": {
        "hidePanel": true,
        "nextSteps": "<a href='/kls-magic-link/check-your-email' class='govuk-back-link'>Back</a><h1 class='govuk-heading-l'>We've sent you another email</h1><p class=\"govuk-body\">We’ve sent another email to {{ email }}. <br><br> Click the link in the email to continue to with your enquiry. </p><h3 class=\"govuk-heading-m\">If you've not received an email</h3><p class=\"govuk-body\">Check your spam or junk folder.<br><br>If you’ve still not received the email in 5 minutes, you need to request a new link.</p><a href='/kls-magic-link' role='button' draggable='false' class='govuk-button' data-module='govuk-button' data-prevent-double-click='true'>Request a new link</button></a>"
      }
    }
  },
  "lists": [],
  "sections": [],
  "phaseBanner": {
    "phase": "beta"
  },
  "metadata": {},
  "fees": [],
  "outputs": [
    {
      "name": "magiclink",
      "title": "KLS MagicLink",
      "type": "notify",
      "outputConfiguration": {
        "apiKey": "${KLSnotifyApiKey}",
        "templateId": "${KLSNotifyTemplateId}",
        "emailField": "email",
        "addReferencesToPersonalisation": false,
        "personalisation": ["email", "hmacSignature", "hmacExpiryTime"],
        "hmacKey": "${KLSMagicLinkHmacKey}"
      }
    }
  ],
  "jwtKey": "${KLSJwtKey}",
  "feedback": {
    "feedbackForm": true,
    "url": "/feedback"
  },
  "version": 2,
  "conditions": []
}
